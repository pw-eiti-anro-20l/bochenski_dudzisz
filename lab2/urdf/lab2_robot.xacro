<?xml version="1.0"?>

<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="lab2_robot">

    <!-- XACRO THINGS -->
    <!-- loading robot parameters -->
    <xacro:arg name="params_filename" default="../urdf_params.yaml"/>
    <xacro:property name="params_file" value="$(arg params_filename)"/>
    <xacro:property name="robot_params" value="${load_yaml(params_file)}"/>
    <xacro:property name="joint1_params" value="${robot_params[0]}"/>
    <xacro:property name="joint2_params" value="${robot_params[1]}"/>
    <xacro:property name="joint3_params" value="${robot_params[2]}"/>

    <!-- macros -->

    <xacro:macro name="default_joint" params="joint_params">
        <joint name="joint${joint_params['nr']}" type="continuous">
            <parent link="link${joint_params['nr'] - 1}"/>
            <child link="link${joint_params['nr']}"/>
            <origin xyz="${joint_params['xyz']}" rpy="${joint_params['rpy']}"/>
            <axis xyz="0 0 1"/>
        </joint>
    </xacro:macro>

    <material name="blue">
        <color rgba="0 0 0.9 1"/>
    </material>

    <xacro:macro name="default_link" params="joint_params">
        <link name="link${joint_params['nr'] - 1}">
            <visual>
                <geometry>
                    <cylinder length="${joint_params['link_length']}" radius="0.05"/>
                </geometry>
                <origin xyz="${joint_params['link_xyz']}" rpy="${joint_params['link_rpy']}"/>
                <material name="blue"/>
            </visual>
        </link>
    </xacro:macro>



    
    <!-- ROBOT BUILD STARTS HERE -->

    <link name="base_link">
        <visual>
            <geometry>
                <cylinder length="0.05" radius="0.05"/>
            </geometry>
            <origin xyz="0 0 0.025"/>
            <material name="blue"/>
        </visual>
    </link>
    <xacro:default_link joint_params="${joint2_params}"/>
    <xacro:default_link joint_params="${joint3_params}"/>
    
    <link name="link3">
        <visual>
            <geometry>
                <cylinder length="0.05" radius="0.02"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <material name="blue"/>
        </visual>
    </link>

    <joint name="joint1" type="continuous">
        <parent link="base_link"/>
        <child link="link1"/>
        <origin xyz="${joint1_params['xyz']}" rpy="${joint1_params['rpy']}"/>
        <axis xyz="0 0 1"/>
    </joint>
    <xacro:default_joint joint_params="${joint2_params}"/>
    <xacro:default_joint joint_params="${joint3_params}"/>

</robot>